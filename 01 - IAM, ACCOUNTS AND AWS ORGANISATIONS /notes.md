# IAM, ACCOUNTS AND AWS ORGANISATIONS

## IAM Identity Policies

IAM Policies are a type of policies that get attached to an Identity within AWS.

*Identities* = IAM Users, IAM Groups, IAM Roles

An IAM Policy is a set of Security Statement to AWS, that grants/deny access to any Identity that uses that Policy.
They're created in JSON, containing multiple statements.

![IAMPolicies-1](https://github.com/acantril/aws-sa-associate-saac03/blob/main/0600-IAM_ACCOUNTS_ORGS/00_LEARNINGAIDS/IAMPolicies-1.png?raw=true)

> **IMPORTANT** If there are multiple statements in a Policy, then **ALL** statements will be processed and applied.
These rules are applied with a defined priority:

1. Explicit Deny
2. Explicit Allow
3. Implicit Deny

If Identities are not explicitly allowed access, then they're not allowed allowed any access to anything.
**Exception** = Root Account

![IAMPolicies-2](https://github.com/acantril/aws-sa-associate-saac03/blob/main/0600-IAM_ACCOUNTS_ORGS/00_LEARNINGAIDS/IAMPolicies-2.png?raw=true)

There are 2 main types of policies:

1. Inline Policies
    - Individual JSON, applied individually to an Identity
    - Used for exceptions to any standard scenario
2. Managed Policies
    - Policy that can be attached to any Identity that might need them.
    - Should be used as a Default
    - They are Reusable
    - They offer Low Management Overhead

![IAMPolicies-3](https://github.com/acantril/aws-sa-associate-saac03/blob/main/0600-IAM_ACCOUNTS_ORGS/00_LEARNINGAIDS/IAMPolicies-4.png?raw=true)

## IAM Users and ARNs

IAM users are an Identity use for anything requiring AWS Access. e.g. Humans, Applications, Service Accounts.

IAM starts with a *principal*.

A *principal* can be anything, but in order to be able to do anything, it needs to authenticate against an Identity within IAM.
Authentication is done via *Username and Password* or *Access Keys*.
Once a principal authenticates, it's now an *authenticated identity*.

Once it's an *authenticated identity*, then it will have to be authorised via *policies* applied to it.

![IAMUsers-1](https://github.com/acantril/aws-sa-associate-saac03/blob/main/0600-IAM_ACCOUNTS_ORGS/00_LEARNINGAIDS/IAMUsers-1.png?raw=true)

### Amazon Resource Names (ARNs)

ARNs uniquely identify resources within any AWS Account.

ARNs are connection of fields, split by a colon. If you see a double colon, then it mean that that specific field doesn't need to be specified.

A * can be used, which is a wildcard.

![ARN-1](https://github.com/acantril/aws-sa-associate-saac03/blob/main/0600-IAM_ACCOUNTS_ORGS/00_LEARNINGAIDS/IAMUsers-2.png?raw=true)

> The top ARN refers to the **Bucket**
> The bottom ARN refers to the **Objects** in the bucket, and **NOT** the Bucket itself.

### Exam PowerUps

- Max 5000 IAM users per AWS Account
- a IAM User can be a member of 10 IAM Groups

## IAM Groups

IAM Groups are containers for IAM Users.
You **can't login** to IAM Groups, and they've got no credentials of their own.

> An IAM user can be a member of multiple IAM Groups.

Groups can have policies attached to them, both:

- Inline Policies
- Managed Policies

Policies will merge; collect all the Allows + Denies, and the same hierarchy applies here; an Explicit Deny will always win over an Explicit Allow.

> There's no All Users Group (like in Azure) as Default/Natively.

Groups **DO NOT** allow nesting, there's no concept of group within a group.

Groups are limited to 300 Groups/account, but they can be increased with a support ticket.

![IAMGroups-1](https://github.com/acantril/aws-sa-associate-saac03/blob/main/0600-IAM_ACCOUNTS_ORGS/00_LEARNINGAIDS/IAM-Groups-1.png?raw=true)

> **Groups are NOT a TRUE Identity! They can't be referenced as a Principal in a policy.**

## IAM Roles

A role is a type of Identity that exists within AWS.
IAM Roles are best suited to be used by multiple Principals (users, service accounts, etc.).

IAM Roles are often used on a temporary basis.

A User can assume a Role, and assume its rights temporarily.

![IAMRoles-1](https://github.com/acantril/aws-sa-associate-saac03/blob/main/0600-IAM_ACCOUNTS_ORGS/00_LEARNINGAIDS/IAMRoles-1.png?raw=true)

IAM Roles have 2 type of policies that can be attached:

- Trust Policy
  - Control which Identities can assume that role
  - It can reference Identities in the same account AND in other AWS Accounts.
  - It can allow anonymous usage of that role.
- Permission Policy
  - Define what resources can be accessed by an identity that assumes that role

If a role is assumed by an Identity that's allowed to assume it, it will generate **temporary security credentials** for it. These credentials are generated by the **STS** Service.
Temporary credentials are like Access Keys, but they're time based, as they can and will expire.
This Temporary Credentials will be able to access resources defined within the **Permission Policy**.

> Roles are REAL Identities, and as such they can be accessed within Resource Policies.a

![IAMRoles-2](https://github.com/acantril/aws-sa-associate-saac03/blob/main/0600-IAM_ACCOUNTS_ORGS/00_LEARNINGAIDS/IAMRoles-2.png?raw=true)

Roles are used within an AWS Organisation to access different accounts, without having to login with multiple accounts every time.

### When to use an IAM Role

A Role should be used to access products and services within AWS, as that makes so that no credentials need to be embedded withing the product/service itself (e.g. a Lambda Function)

![IAMRoles-3](https://github.com/acantril/aws-sa-associate-saac03/blob/main/0600-IAM_ACCOUNTS_ORGS/00_LEARNINGAIDS/IAMRoles-3.png?raw=true)

Another scenario is an emergency, or out of the norm situation --> for example, a Break Glass Scenario.

![IAMRoles-4](https://github.com/acantril/aws-sa-associate-saac03/blob/main/0600-IAM_ACCOUNTS_ORGS/00_LEARNINGAIDS/IAMRoles-4.png?raw=true)

> **External Accounts/Identities cannot be used to interact with AWS**

### Service-Linked Roles & PassRole

Service-linked roles are a special type of IAM Role --> It's an IAM Role linked to a specific AWS Service.
They're usually created by the service itself, or the service might prompt you to create a Service-linked role as you spin up the service.

![IAMServiceLinkedRole-1](https://github.com/acantril/aws-sa-associate-saac03/blob/main/0600-IAM_ACCOUNTS_ORGS/00_LEARNINGAIDS/ServiceLinkedRole1.png?raw=true)

## AWS Organisations

AWS Organisations is a product to manage multiple AWS Accounts with little overhead, and little cost.
You create an AWS Organisation with a Standard AWS Account --> This then becomes the Management/Master Account for this AWS Organisation.

With this account, you can invite other existing Standard AWS Accounts within the AWS Organisation; When these accounts join they change from a Standard AWS Account --> Member Account.

An AWS Organisation will contain an Organisation Root, which is effectively a container  that contains all accounts withing the AWS Organisation.
The Organisation Root can contain other containers, called Organisational Units (OUs).

An important component of AWS Organisation is *consolidated billing*.
The member accounts pass over the bills to the Master Account through *consolidated billing*.
 > This has got a massive economical benefit, as discounts through volume or reserveation do stack via consolidated billing within an organisation

As well as being able to invite existing accounts within an AWS Organisation, we can also create a New Account within it.

Using an AWS Organisation changes how best practices work withing the AWS world.
Best practice is having one Management Account that contains all of the identities which are logged into. If the business is a large enterprise, they might already have their own Identity System, and they might want to use their pre-existing Identities to access their AWS Account via Identity Federation.
> E.G. Azure AD --> Identity Federation --> Assume roles within AWS Organisation.